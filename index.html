<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My C Code Notebook</title>
<style>
  :root{
    --bg:#0f172a;        /* slate-900 */
    --panel:#111827;     /* gray-900 */
    --muted:#334155;     /* slate-600 */
    --text:#e5e7eb;      /* gray-200 */
    --accent:#22c55e;    /* green-500 */
    --accent-2:#60a5fa;  /* blue-400 */
    --warn:#f59e0b;      /* amber-500 */
    --danger:#ef4444;    /* red-500 */
    --ok:#10b981;        /* emerald-500 */
    --border:#1f2937;    /* gray-800 */
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); background:linear-gradient(180deg,#0b1223,#0f172a 30%,#0f172a);
    min-height:100vh;
  }
  /* Top bar */
  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter:saturate(160%) blur(10px);
    background:rgba(15,23,42,.8); border-bottom:1px solid var(--border);
  }
  .bar{
    max-width:1200px; margin:auto; padding:10px 16px; display:flex; gap:12px; align-items:center;
  }
  .logo{
    font-weight:700; letter-spacing:.4px; display:flex; align-items:center; gap:10px;
  }
  .logo .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
  .bar .grow{flex:1}
  .bar input[type="search"]{
    width:100%; max-width:420px; padding:10px 12px; border:1px solid var(--border); border-radius:10px;
    background:#0b1020; color:var(--text);
  }
  .btn{
    padding:10px 14px; border:1px solid var(--border); border-radius:10px; cursor:pointer;
    background:#0d1428; color:var(--text);
  }
  .btn:hover{border-color:#2a3448}
  .btn.accent{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#051014; border:none; font-weight:700}
  .btn.ghost{background:transparent}
  .hidden{display:none}
  main{max-width:1200px; margin:20px auto 80px; padding:0 16px; display:grid; gap:16px; grid-template-columns: 1.2fr .8fr;}
  @media (max-width:980px){ main{grid-template-columns:1fr} }
  section, aside{
    background:rgba(17,24,39,.6); border:1px solid var(--border); border-radius:14px; overflow:hidden;
  }
  .section-head{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:12px 14px; border-bottom:1px solid var(--border); background:rgba(2,6,23,.35);
  }
  .section-head h2{margin:0; font-size:16px; opacity:.9}
  .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
  .controls .btn{padding:8px 12px; font-size:14px}
  /* Editor + preview */
  .editor-wrap{display:grid; grid-template-columns:1fr 1fr; gap:0; min-height:480px}
  @media (max-width:980px){ .editor-wrap{grid-template-columns:1fr} }
  .pane{
    display:flex; flex-direction:column; min-height:320px;
  }
  .pane .title{
    padding:10px 12px; font-size:12px; letter-spacing:.2px; text-transform:uppercase; color:#b8c0d9; background:rgba(2,6,23,.35); border-bottom:1px solid var(--border)
  }
  textarea{
    flex:1; width:100%; padding:14px; font: 14px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    color:#e6edf3; background:#0b1020; border:0; resize:vertical; min-height:300px; outline:none;
  }
  pre{
    margin:0; flex:1; overflow:auto; background:#0c1326; padding:14px;
    font: 14px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; border-left:1px dashed #1a2336;
    tab-size:4; white-space:pre; caret-color:transparent;
  }
  /* Simple syntax highlighting */
  code .kw{color:#93c5fd}        /* keywords */
  code .type{color:#a7f3d0}      /* types */
  code .str{color:#fca5a5}       /* strings */
  code .num{color:#fde68a}       /* numbers */
  code .com{color:#94a3b8; font-style:italic} /* comments */
  code .dir{color:#86efac}       /* preprocessor */
  code .fn{color:#c4b5fd}
  /* Suggestions panel */
  .suggestions{padding:12px}
  .suggestions .tip{
    border:1px solid var(--border); background:#0b1223; border-radius:12px; padding:10px 12px; margin:10px 0;
  }
  .tip .tag{font-size:11px; padding:3px 8px; border-radius:999px; margin-right:8px}
  .sev-good{background:rgba(16,185,129,.12); color:var(--ok); border:1px solid rgba(16,185,129,.35)}
  .sev-warn{background:rgba(245,158,11,.12); color:var(--warn); border:1px solid rgba(245,158,11,.35)}
  .sev-bad{ background:rgba(239,68,68,.12); color:var(--danger); border:1px solid rgba(239,68,68,.35)}
  .muted{color:#9aa4bd; font-size:13px}
  /* Saved snippets */
  .list{max-height:280px; overflow:auto; border-top:1px solid var(--border)}
  .item{
    padding:10px 12px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; gap:8px;
  }
  .item .meta{font-size:12px; color:#9aa4bd}
  input.title{
    width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#0b1020; color:var(--text)
  }
  footer{
    max-width:1200px; margin:24px auto; padding:0 16px; color:#9aa4bd; font-size:12px; text-align:center
  }
</style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="logo"><span class="dot"></span> <span>My C Code Notebook</span></div>
      <div class="grow"><input id="search" type="search" placeholder="Search saved snippets by title or text…" /></div>
      <button class="btn" id="newBtn" title="New (Ctrl+N)">New</button>
      <button class="btn accent" id="saveBtn" title="Save (Ctrl+S)">Save</button>
    </div>
  </header>

  <main>
    <section>
      <div class="section-head">
        <h2>Editor</h2>
        <div class="row controls">
          <input id="title" class="title" placeholder="Untitled program.c" />
          <button class="btn" id="copyBtn" title="Copy to clipboard">Copy</button>
          <button class="btn" id="exportBtn" title="Download .c file">Export</button>
          <label class="btn ghost" title="Import .c file">
            Import <input id="importFile" class="hidden" type="file" accept=".c,.txt" />
          </label>
        </div>
      </div>

      <div class="editor-wrap">
        <div class="pane">
          <div class="title">Write C here</div>
          <textarea id="code" spellcheck="false">// Example: Hello World
#include &lt;stdio.h&gt;

int main(void){
    printf("Hello, World!\\n");
    return 0;
}
</textarea>
        </div>
        <div class="pane">
          <div class="title">Preview (read-only)</div>
          <pre><code id="preview"></code></pre>
        </div>
      </div>

      <div class="section-head">
        <h2>Saved Snippets</h2>
        <div class="row">
          <button class="btn" id="deleteAllBtn" title="Delete all saved">Delete All</button>
        </div>
      </div>
      <div id="list" class="list"></div>
    </section>

    <aside>
      <div class="section-head">
        <h2>Suggestions</h2>
        <div class="row">
          <span class="muted" id="summary">Live checks as you type</span>
        </div>
      </div>
      <div id="sugs" class="suggestions"></div>
    </aside>
  </main>

  <footer>Tip: Press <b>Ctrl/⌘ + S</b> to save, <b>Ctrl/⌘ + N</b> for a fresh file. Everything stays in your browser (localStorage).</footer>

<script>
/* ========= Local storage & state ========= */
const storeKey = 'cSnippets.v1';
let snippets = loadSnippets();
let currentId = null;

function loadSnippets(){
  try{ return JSON.parse(localStorage.getItem(storeKey)) || []; }
  catch{ return []; }
}
function saveSnippets(){
  localStorage.setItem(storeKey, JSON.stringify(snippets));
}
function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }

/* ========= Elements ========= */
const codeEl = document.getElementById('code');
const prevEl = document.getElementById('preview');
const sugsEl = document.getElementById('sugs');
const listEl = document.getElementById('list');
const titleEl = document.getElementById('title');
const summaryEl = document.getElementById('summary');
const searchEl = document.getElementById('search');

/* ========= Syntax highlighting (lightweight) ========= */
function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function highlightC(src){
  let s = escapeHtml(src);
  // comments
  s = s.replace(/\/\*[\s\S]*?\*\//g, m=> `<span class="com">${m}</span>`);
  s = s.replace(/(^|[^:])\/\/.*$/gm, (m,p1)=> `${p1}<span class="com">${m.slice(p1?1:0)}</span>`);
  // strings & chars
  s = s.replace(/'(?:\\.|[^'\\])'/g, m=> `<span class="str">${m}</span>`);
  s = s.replace(/"(?:\\.|[^"\\])*"/g, m=> `<span class="str">${m}</span>`);
  // preprocessor
  s = s.replace(/^(#\s*[\w]+)(.*)$/gm, (m,a,b)=> `<span class="dir">${a}</span>${b}`);
  // numbers
  s = s.replace(/\b(?:0x[0-9a-fA-F]+|\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)\b/g, m=> `<span class="num">${m}</span>`);
  // keywords & types
  const kw = /\b(auto|break|case|const|continue|default|do|else|enum|extern|for|goto|if|register|return|sizeof|static|struct|switch|typedef|union|volatile|while)\b/g;
  const types = /\b(void|int|long|short|float|double|char|signed|unsigned|bool|_Bool|size_t)\b/g;
  s = s.replace(kw, m=> `<span class="kw">${m}</span>`);
  s = s.replace(types, m=> `<span class="type">${m}</span>`);
  // very light function name coloring: name(
  s = s.replace(/\b([a-zA-Z_]\w*)\s*(?=\()/g, (m,fn)=> `<span class="fn">${fn}</span>`);
  return s;
}

/* ========= Suggestions (simple static checks) ========= */
function analyze(code){
  const tips = [];
  const add = (sev, msg, help='') => tips.push({sev, msg, help});
  const has = (re) => re.test(code);

  // Common headers
  if (/printf|scanf|puts|gets/.test(code) && !/#\s*include\s*<\s*stdio\.h\s*>/.test(code))
    add('bad','Missing <stdio.h> while using stdio functions.', 'Add: #include <stdio.h> at the top.');

  if (/malloc|free|calloc|realloc/.test(code) && !/#\s*include\s*<\s*stdlib\.h\s*>/.test(code))
    add('warn','Using dynamic memory without <stdlib.h>.','Add: #include <stdlib.h>.');

  if (/strlen|strcpy|strcmp|strcat/.test(code) && !/#\s*include\s*<\s*string\.h\s*>/.test(code))
    add('warn','Using string functions without <string.h>.','Add: #include <string.h>.');

  // main signature & return
  if (!/\bint\s+main\s*\(/.test(code))
    add('warn','main should normally return int.','Prefer: int main(void) { … }');

  // Return 0 in main (skip if quick return or non-standard)
  const hasMain = /\bint\s+main\s*\([^)]*\)\s*\{[\s\S]*\}/m.test(code);
  if (hasMain && !/return\s+0\s*;/.test(code))
    add('warn','No "return 0;" found in main.','Add return 0; at the end of main.');

  // Dangerous / non-standard calls
  if (/gets\s*\(/.test(code)) add('bad','Avoid gets(): it is unsafe.','Use fgets(buffer, size, stdin) instead.');
  if (/scanf\s*\(\s*"%s"/.test(code)) add('warn','scanf("%s") can overflow.','Use width: scanf("%19s", str);');
  if (/system\s*\(\s*"(cls|clear)"/.test(code)) add('warn','Avoid system("cls"/"clear").','Not portable and unsafe.');
  if (/\bconio\.h\b|getch\s*\(/.test(code)) add('warn','Non-standard <conio.h>/getch().','Avoid in portable code.');

  // Unused headers
  if (/#\s*include\s*<\s*bits\/stdc\+\+\.h\s*>/.test(code)) add('warn','<bits/stdc++.h> is C++ only.','Remove it in C programs.');

  // Style suggestions
  if (!/\/\*/.test(code) && !/\/\/.*/.test(code))
    add('good','Consider adding comments.','Explain logic above tricky parts.');
  if (/\tt/.test(code) || / {1,3}\S/.test(code)) {/* noop */}
  // Trailing newline
  if (!/\n\s*$/.test(code)) add('good','Add a newline at end of file.','Helps with some tools/compilers.');

  // Summary
  summaryEl.textContent = tips.length ? `${tips.length} suggestion${tips.length>1?'s':''} found` : 'Looks good! No obvious issues.';
  renderTips(tips);
}
function renderTips(tips){
  sugsEl.innerHTML = tips.map(t=>{
    const tag = t.sev==='bad'?'sev-bad':(t.sev==='warn'?'sev-warn':'sev-good');
    const label = t.sev==='bad'?'Issue':(t.sev==='warn'?'Warning':'Tip');
    return `<div class="tip">
      <span class="tag ${tag}">${label}</span>
      <div style="margin-top:6px">${escapeHtml(t.msg)}</div>
      ${t.help?`<div class="muted" style="margin-top:6px">${escapeHtml(t.help)}</div>`:''}
    </div>`;
  }).join('') || `<div class="muted" style="padding:12px">No suggestions yet. Start typing your code!</div>`;
}

/* ========= Save/Load/List ========= */
function renderList(filter=''){
  const q = filter.trim().toLowerCase();
  const items = snippets.filter(s=>{
    if(!q) return true;
    return s.title.toLowerCase().includes(q) || s.code.toLowerCase().includes(q);
  });
  listEl.innerHTML = items.map(s=>`
    <div class="item">
      <div>
        <div><b>${escapeHtml(s.title || 'Untitled')}</b></div>
        <div class="meta">${new Date(s.updated).toLocaleString()}</div>
      </div>
      <div class="row">
        <button class="btn" onclick="loadById('${s.id}')">Open</button>
        <button class="btn" onclick="downloadCode('${s.id}')">Export</button>
        <button class="btn" onclick="deleteById('${s.id}')">Delete</button>
      </div>
    </div>
  `).join('') || `<div class="muted" style="padding:12px">No saved snippets yet.</div>`;
}
function loadById(id){
  const s = snippets.find(x=>x.id===id); if(!s) return;
  currentId = id;
  titleEl.value = s.title; codeEl.value = s.code;
  refresh();
  window.scrollTo({top:0, behavior:'smooth'});
}
function deleteById(id){
  if(!confirm('Delete this snippet?')) return;
  snippets = snippets.filter(x=>x.id!==id);
  saveSnippets(); renderList(searchEl.value);
}
function download(content, name, type='text/plain'){
  const blob = new Blob([content], {type});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = name; a.click();
  URL.revokeObjectURL(a.href);
}
function downloadCode(id){
  const s = snippets.find(x=>x.id===id); if(!s) return;
  download(s.code, (s.title||'program')+'.c', 'text/x-c');
}
function newFile(){
  currentId = null;
  titleEl.value = ''; codeEl.value = '';
  refresh();
}
function saveFile(){
  const title = (titleEl.value || 'Untitled program').replace(/\.(c|txt)$/i,'');
  const code = codeEl.value;
  const now = Date.now();
  if(currentId){
    const s = snippets.find(x=>x.id===currentId);
    if(s){ s.title = title; s.code = code; s.updated = now; }
  }else{
    const s = {id: uid(), title, code, updated: now};
    snippets.unshift(s);
    currentId = s.id;
  }
  saveSnippets(); renderList(searchEl.value);
  flashSaved();
}
function flashSaved(){
  const btn = document.getElementById('saveBtn');
  const old = btn.textContent; btn.textContent = 'Saved ✓';
  setTimeout(()=>btn.textContent = old, 900);
}

/* ========= Import / Export / Copy ========= */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const name = (titleEl.value || 'program') + '.c';
  download(codeEl.value, name, 'text/x-c');
});
document.getElementById('importFile').addEventListener('change', async (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const text = await file.text();
  if(!codeEl.value.trim()){ codeEl.value = text; }
  else{
    // append with separator
    codeEl.value += `\n\n/* ---- Imported: ${file.name} ---- */\n`+text;
  }
  refresh();
  e.target.value = '';
});
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(codeEl.value); alert('Copied to clipboard'); }
  catch{ alert('Copy failed. Select text and press Ctrl+C.'); }
});

/* ========= Handlers ========= */
document.getElementById('saveBtn').addEventListener('click', saveFile);
document.getElementById('newBtn').addEventListener('click', newFile);
document.getElementById('deleteAllBtn').addEventListener('click', ()=>{
  if(confirm('Delete ALL saved snippets?')){ snippets = []; saveSnippets(); renderList(); }
});
searchEl.addEventListener('input', ()=> renderList(searchEl.value));
titleEl.addEventListener('input', ()=> {/* title live updates only on save */});

codeEl.addEventListener('input', refresh);
function refresh(){
  prevEl.innerHTML = highlightC(codeEl.value);
  analyze(codeEl.value);
}
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); saveFile(); }
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='n'){ e.preventDefault(); newFile(); }
});

/* ========= Init ========= */
renderList();
refresh();
</script>
</body>
</html>

